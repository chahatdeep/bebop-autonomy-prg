!function(e,t){function l(e){e.toggleClass("open")}var o=function(e){var t,l=e.createElement("details");if(!("open"in l))return!1;var o=e.body||function(){var l=e.documentElement;return t=!0,l.insertBefore(e.createElement("body"),l.firstElementChild||l.firstChild)}();l.innerHTML="<summary>a</summary>b",l.style.display="block",o.appendChild(l);var n=l.offsetHeight;return l.open=!0,n=n!==l.offsetHeight,o.removeChild(l),t&&o.parentNode.removeChild(o),n}(e);t.fn.details=function(){return o?this:this.each(function(){var e=t(this),o=t("summary",e).first();o.prop("tabIndex",0),o.on("keydown",function(t){if(32===t.keyCode||13===t.keyCode)return l(e),!1}),o.on("click",function(){o.focus(),l(e)})})}}(document,jQuery),define("discourse/plugins/discourse-details/initializers/apply-details",["exports","discourse/lib/plugin-api"],function(e,t){"use strict";function l(e){e.decorateCooked(function(e){return $("details",e).details()}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"insertDetails",icon:"caret-right",label:"details.title"}}),e.modifyClass("controller:composer",{actions:{insertDetails:function(){this.get("toolbarEvent").applySurround('\n[details="'+I18n.t("composer.details_title")+'"]\n',"\n[/details]\n","details_text",{multiline:!1}),this.set("optionsVisible",!1)}}})}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"apply-details",initialize:function(){(0,t.withPluginApi)("0.8.7",l)}}}),define("discourse/plugins/discourse-details/lib/discourse-markdown/details",["exports"],function(e){"use strict";function t(e){e.whiteList(["summary","summary[title]","details","details[open]","details.elided"]),e.registerPlugin(function(e){e.block.bbcode.ruler.push("details",l)})}Object.defineProperty(e,"__esModule",{value:!0}),e.setup=t;var l={tag:"details",before:function(e,t){var l=t.attrs;e.push("bbcode_open","details",1),e.push("bbcode_open","summary",1),e.push("text","",0).content=l._default||"",e.push("bbcode_close","summary",-1)},after:function(e){e.push("bbcode_close","details",-1)}}}),Ember.TEMPLATES["javascripts/discourse/connectors/user-summary-stat/solved-count"]=Ember.HTMLBars.template({id:null,block:'{"statements":[[6,["link-to"],["userActivity.solved"],null,{"statements":[[0,"  "],[1,[33,["user-stat"],null,[["value","label"],[[28,["model","solved_count"]],"solved.solution_summary"]]],false],[0,"\\n"]],"locals":[]},null]],"locals":[],"named":[],"yields":[],"hasPartials":false}',meta:{moduleName:"javascripts/discourse/connectors/user-summary-stat/solved-count"}}),Ember.TEMPLATES["javascripts/discourse/connectors/user-activity-bottom/solved-list"]=Ember.HTMLBars.template({id:null,block:'{"statements":[[6,["link-to"],["userActivity.solved"],null,{"statements":[[0,"  "],[11,"i",[]],[15,"class","glyph fa fa-check-square"],[13],[14],[1,[33,["i18n"],["solved.title"],null],false],[0,"\\n"]],"locals":[]},null]],"locals":[],"named":[],"yields":[],"hasPartials":false}',meta:{moduleName:"javascripts/discourse/connectors/user-activity-bottom/solved-list"}}),Ember.TEMPLATES["javascripts/discourse/connectors/category-custom-settings/solved-settings"]=Ember.HTMLBars.template({id:null,block:'{"statements":[[6,["unless"],[[28,["siteSettings","allow_solved_on_all_topics"]]],null,{"statements":[[11,"section",[]],[15,"class","field"],[13],[0,"\\n  "],[11,"div",[]],[15,"class","enable-accepted-answer"],[13],[0,"\\n    "],[11,"label",[]],[15,"class","checkbox-label"],[13],[0,"\\n      "],[1,[33,["input"],null,[["type","checked"],["checkbox",[28,["category","enable_accepted_answers"]]]]],false],[0,"\\n      "],[1,[33,["i18n"],["solved.allow_accepted_answers"],null],false],[0,"\\n    "],[14],[0,"\\n  "],[14],[0,"\\n"],[14],[0,"\\n"]],"locals":[]},null]],"locals":[],"named":[],"yields":[],"hasPartials":false}',meta:{moduleName:"javascripts/discourse/connectors/category-custom-settings/solved-settings"}}),Ember.TEMPLATES["javascripts/discourse/connectors/topic-after-cooked/solved-panel"]=Ember.HTMLBars.template({id:null,block:'{"statements":[[6,["if"],[[28,["topic","accepted_answer"]]],null,{"statements":[[11,"p",[]],[15,"class","solved"],[13],[0,"\\n"],[1,[28,["topic","acceptedAnswerHtml"]],true],[0,"\\n"],[14],[0,"\\n"]],"locals":[]},null]],"locals":[],"named":[],"yields":[],"hasPartials":false}',meta:{moduleName:"javascripts/discourse/connectors/topic-after-cooked/solved-panel"}}),define("discourse/plugins/discourse-solved/discourse/routes/user-activity-solved",["exports","discourse/routes/user-activity-stream"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.default.extend({userActionType:15,noContentHelpKey:"solved.no_solutions"})}),define("discourse/plugins/discourse-solved/discourse/initializers/extend-for-solved-button",["exports","discourse/models/topic","discourse/models/user","discourse/raw-views/topic-status","discourse/lib/ajax-error","discourse/lib/plugin-api","discourse/lib/ajax","discourse/widgets/post-cooked"],function(e,t,l,o,n,s,i,a){"use strict";function r(e){e.get("postStream.posts").forEach(function(e){e.get("post_number")>1&&(e.set("accepted_answer",!1),e.set("can_accept_answer",!0),e.set("can_unaccept_answer",!1))})}function u(e){if(e.get("can_unaccept_answer")){var t=e.topic;e.setProperties({can_accept_answer:!0,can_unaccept_answer:!1,accepted_answer:!1}),t.set("accepted_answer",void 0),(0,i.ajax)("/solution/unaccept",{type:"POST",data:{id:e.get("id")}}).catch(n.popupAjaxError)}}function p(e){var t=e.topic;r(t),e.setProperties({can_unaccept_answer:!0,can_accept_answer:!1,accepted_answer:!0}),t.set("accepted_answer",{username:e.get("username"),post_number:e.get("post_number"),excerpt:e.get("cooked")}),(0,i.ajax)("/solution/accept",{type:"POST",data:{id:e.get("id")}}).catch(n.popupAjaxError)}function c(e){var t=e.getCurrentUser();e.includePostAttributes("can_accept_answer","can_unaccept_answer","accepted_answer"),e.addDiscoveryQueryParam&&e.addDiscoveryQueryParam("solved",{replace:!0,refreshModel:!0}),e.addPostMenuButton("solved",function(e){var l=e.can_accept_answer,o=e.can_unaccept_answer,n=e.accepted_answer,s=t&&t.id===e.topicCreatedById,i=n||!l||s?"first":"second-last-hidden";if(l)return{action:"acceptAnswer",icon:"check-square-o",className:"unaccepted",title:"solved.accept_answer",position:i};if(o||n){return{action:"unacceptAnswer",icon:"check-square",title:o?"solved.unaccept_answer":"solved.accepted_answer",className:"accepted fade-out",position:i,beforeButton:function(e){return e("span.accepted-text",I18n.t("solved.solution"))}}}}),e.decorateWidget("post-contents:after-cooked",function(e){if(1===e.attrs.post_number){var t=e.getModel();if(t){var l=t.get("topic");if(l.get("accepted_answer")){var o=!!l.get("accepted_answer").excerpt,n="\n            <aside class='quote' data-post=\""+l.get("accepted_answer").post_number+'" data-topic="'+l.get("id")+"\">\n              <div class='title'>\n                "+l.get("acceptedAnswerHtml")+' <div class="quote-controls"></div>\n              </div>\n              <blockquote>\n                '+l.get("accepted_answer").excerpt+"\n              </blockquote>\n            </aside>",s="\n            <aside class='quote'>\n              <div class='title title-only'>\n                "+l.get("acceptedAnswerHtml")+"\n              </div>\n            </aside>",i=new a.default({cooked:o?n:s}),r=i.init();return e.rawHtml(r)}}}}),e.attachWidgetAction("post","acceptAnswer",function(){var e=this,t=this.model,l=t.get("topic.postStream.posts").filter(function(e){return 1===e.get("post_number")||e.get("accepted_answer")});p(t),l.forEach(function(t){return e.appEvents.trigger("post-stream:refresh",{id:t.id})})}),e.attachWidgetAction("post","unacceptAnswer",function(){var e=this.model,t=e.get("topic.postStream.posts").find(function(e){return 1===e.get("post_number")});u(e),this.appEvents.trigger("post-stream:refresh",{id:t.get("id")})}),e.registerConnectorClass&&(e.registerConnectorClass("user-activity-bottom","solved-list",{shouldRender:function(e,t){return t.siteSettings.solved_enabled}}),e.registerConnectorClass("user-summary-stat","solved-count",{shouldRender:function(e,t){return t.siteSettings.solved_enabled&&e.model.solved_count>0},setupComponent:function(){this.set("classNames",["linked-stat"])}}))}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"extend-for-solved-button",initialize:function(){t.default.reopen({acceptedAnswerHtml:function(){var e=this.get("accepted_answer.username"),t=this.get("accepted_answer.post_number");return e&&t?I18n.t("solved.accepted_html",{username_lower:e.toLowerCase(),username:e,post_path:this.get("url")+"/"+t,post_number:t,user_path:l.default.create({username:e}).get("path")}):""}.property("accepted_answer","id")}),o.default.reopen({statuses:function(){var e=this._super();return this.topic.has_accepted_answer?e.push({openTag:"span",closeTag:"span",title:I18n.t("solved.has_accepted_answer"),icon:"check-square-o"}):this.topic.can_have_answer&&this.siteSettings.solved_enabled&&this.siteSettings.empty_box_on_unsolved&&e.push({openTag:"span",closeTag:"span",title:I18n.t("solved.has_no_accepted_answer"),icon:"square-o"}),e}.property()}),(0,s.withPluginApi)("0.1",c),(0,s.withPluginApi)("0.8.10",function(e){e.replaceIcon("notification.solved.accepted_notification","check-square")})}}}),define("discourse/plugins/discourse-solved/discourse/pre-initializers/extend-category-for-solved",["exports","ember-addons/ember-computed-decorators","discourse/models/category"],function(e,t,l){"use strict";function o(e,t,l,o,n){var s={};return Object.keys(o).forEach(function(e){s[e]=o[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=l.slice().reverse().reduce(function(l,o){return o(e,t,l)||l},s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"extend-category-for-solved",before:"inject-discourse-objects",initialize:function(){var e,n,s;l.default.reopen((e=(0,t.default)("custom_fields.enable_accepted_answers"),n={enable_accepted_answers:{get:function(e){return"true"===e},set:function(e){return e=e?"true":"false",this.set("custom_fields.enable_accepted_answers",e),e}}},o(n,"enable_accepted_answers",[e],(s=Object.getOwnPropertyDescriptor(n,"enable_accepted_answers"),s=s?s.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return s}}),n),n))}}}),define("discourse/plugins/discourse-solved/discourse/solved-route-map",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={resource:"user.userActivity",map:function(){this.route("solved")}}}),function(e){"use strict";function t(e,t){var l,o,n,s=e.data("width"),i=e.data("height"),a=e.data("ratio")?e.data("ratio"):t.default_ratio,r=e.data("youtube-id"),u=e.data("youtube-title"),p=[],c=e.data("parameters")||"";a=a.split(":"),"number"==typeof s&&"number"==typeof i?(e.width(s),l=i+"px"):"number"==typeof s?(e.width(s),l=s*a[1]/a[0]+"px"):(s=e.width(),0===s&&(s=e.parent().width()),l=a[1]/a[0]*100+"%"),p.push('<div class="ytp-thumbnail">'),p.push('<div class="ytp-large-play-button"'),s<=640&&p.push(' style="transform: scale(0.563888888888889);"'),p.push(">"),p.push("<svg>"),p.push('<path fill-rule="evenodd" clip-rule="evenodd" fill="#1F1F1F" class="ytp-large-play-button-svg" d="M84.15,26.4v6.35c0,2.833-0.15,5.967-0.45,9.4c-0.133,1.7-0.267,3.117-0.4,4.25l-0.15,0.95c-0.167,0.767-0.367,1.517-0.6,2.25c-0.667,2.367-1.533,4.083-2.6,5.15c-1.367,1.4-2.967,2.383-4.8,2.95c-0.633,0.2-1.316,0.333-2.05,0.4c-0.767,0.1-1.3,0.167-1.6,0.2c-4.9,0.367-11.283,0.617-19.15,0.75c-2.434,0.034-4.883,0.067-7.35,0.1h-2.95C38.417,59.117,34.5,59.067,30.3,59c-8.433-0.167-14.05-0.383-16.85-0.65c-0.067-0.033-0.667-0.117-1.8-0.25c-0.9-0.133-1.683-0.283-2.35-0.45c-2.066-0.533-3.783-1.5-5.15-2.9c-1.033-1.067-1.9-2.783-2.6-5.15C1.317,48.867,1.133,48.117,1,47.35L0.8,46.4c-0.133-1.133-0.267-2.55-0.4-4.25C0.133,38.717,0,35.583,0,32.75V26.4c0-2.833,0.133-5.95,0.4-9.35l0.4-4.25c0.167-0.966,0.417-2.05,0.75-3.25c0.7-2.333,1.567-4.033,2.6-5.1c1.367-1.434,2.967-2.434,4.8-3c0.633-0.167,1.333-0.3,2.1-0.4c0.4-0.066,0.917-0.133,1.55-0.2c4.9-0.333,11.283-0.567,19.15-0.7C35.65,0.05,39.083,0,42.05,0L45,0.05c2.467,0,4.933,0.034,7.4,0.1c7.833,0.133,14.2,0.367,19.1,0.7c0.3,0.033,0.833,0.1,1.6,0.2c0.733,0.1,1.417,0.233,2.05,0.4c1.833,0.566,3.434,1.566,4.8,3c1.066,1.066,1.933,2.767,2.6,5.1c0.367,1.2,0.617,2.284,0.75,3.25l0.4,4.25C84,20.45,84.15,23.567,84.15,26.4z M33.3,41.4L56,29.6L33.3,17.75V41.4z"></path>'),p.push('<polygon fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" points="33.3,41.4 33.3,17.75 56,29.6"></polygon>'),p.push("</svg>"),p.push("</div>"),p.push("</div>"),p.push('<div class="html5-info-bar">'),p.push('<div class="html5-title">'),p.push('<div class="html5-title-text-wrapper">'),p.push('<a class="html5-title-text" target="_blank" tabindex="3100" href="https://www.youtube.com/watch?v=',r,'">'),void 0===u||null===u||""===u?p.push("youtube.com/watch?v="+r):p.push(u),p.push("</a>"),p.push("</div>"),p.push("</div>"),p.push("</div>"),e.css({"padding-bottom":l}).html(p.join("")),n=s>640?"maxresdefault.jpg":s>480?"sddefault.jpg":s>320?"hqdefault.jpg":s>120?"mqdefault.jpg":0===s?"hqdefault.jpg":"default.jpg",o=e.find(".ytp-thumbnail").css({"background-image":["url(//img.youtube.com/vi/",r,"/",n,")"].join("")}).addClass("lazyYT-image-loaded").on("click",function(l){l.preventDefault(),!e.hasClass("lazyYT-video-loaded")&&o.hasClass("lazyYT-image-loaded")&&e.html('<iframe src="//www.youtube.com/embed/'+r+"?autoplay=1&"+c+'" frameborder="0" allowfullscreen></iframe>').addClass("lazyYT-video-loaded"),t.onPlay&&t.onPlay(l,e)})}e.fn.lazyYT=function(l){var o={default_ratio:"16:9",callback:null,container_class:"lazyYT-container"},n=e.extend(o,l);return this.each(function(){t(e(this).addClass(n.container_class),n)})}}(jQuery),define("discourse/plugins/lazyYT/initializers/lazyYT",["exports","discourse/lib/plugin-api"],function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"apply-lazyYT",initialize:function(){(0,t.withPluginApi)("0.1",function(e){e.decorateCooked(function(t){0!==$(".lazyYT",t).length&&$(".lazyYT",t).lazyYT({onPlay:function(t,l){var o=parseInt(l.closest("article").data("post-id"));o&&e.preventCloak(o)}})})})}}}),define("discourse/plugins/poll/widgets/discourse-poll",["exports","discourse/widgets/widget","virtual-dom","discourse-common/lib/icon-library","discourse/widgets/raw-html","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/poll/lib/even-round","discourse/widgets/post","discourse/lib/round"],function(e,t,l,o,n,s,i,a,r,u){"use strict";function p(e){return new n.default({html:"<span>"+e.html+"</span>"})}function c(e){return(0,s.ajax)("/polls/voters.json",{type:"get",data:e}).catch(function(e){e?(0,i.popupAjaxError)(e):bootbox.alert(I18n.t("poll.error_while_fetching_voters"))})}Object.defineProperty(e,"__esModule",{value:!0}),(0,t.createWidget)("discourse-poll-option",{tagName:"li",buildAttributes:function(e){return{"data-poll-option-id":e.option.id}},html:function(e){var t=[],l=e.option,n=e.vote,s=-1!==n.indexOf(l.id);return e.isMultiple?t.push((0,o.iconNode)(s?"check-square-o":"square-o")):t.push((0,o.iconNode)(s?"dot-circle-o":"circle-o")),t.push(" "),t.push(p(l)),t},click:function(e){0===$(e.target).closest("a").length&&this.sendWidgetAction("toggleOption",this.attrs.option)}}),(0,t.createWidget)("discourse-poll-load-more",{tagName:"div.poll-voters-toggle-expand",buildKey:function(e){return e.id+"-load-more"},defaultState:function(){return{loading:!1}},html:function(e,t){return t.loading?(0,l.h)("div.spinner.small"):(0,l.h)("a",(0,o.iconNode)("chevron-down"))},click:function(){var e=this.state;if(!e.loading)return e.loading=!0,this.sendWidgetAction("loadMore").finally(function(){return e.loading=!1})}}),(0,t.createWidget)("discourse-poll-voters",{tagName:"ul.poll-voters-list",buildKey:function(e){return e.id()},defaultState:function(){return{loaded:"new",pollVoters:[],offset:1}},fetchVoters:function(){var e=this,t=this.attrs,l=this.state;if("loading"!==l.loaded)return l.loaded="loading",c({post_id:t.postId,poll_name:t.pollName,option_id:t.optionId,offset:l.offset}).then(function(o){l.loaded="loaded",l.offset+=1;var n=o[t.pollName],s="number"===t.pollType?n:n[t.optionId];l.pollVoters=l.pollVoters.concat(s),e.scheduleRerender()})},loadMore:function(){return this.fetchVoters()},html:function(e,t){e.pollVoters&&"new"===t.loaded&&(t.pollVoters=e.pollVoters);var o=t.pollVoters.map(function(e){return(0,l.h)("li",[(0,r.avatarFor)("tiny",{username:e.username,template:e.avatar_template})," "])});return t.pollVoters.length<e.totalVotes&&o.push(this.attach("discourse-poll-load-more",{id:e.id()})),(0,l.h)("div.poll-voters",o)}}),(0,t.createWidget)("discourse-poll-standard-results",{tagName:"ul.results",buildKey:function(e){return e.id+"-standard-results"},defaultState:function(){return{loaded:"new"}},fetchVoters:function(){var e=this,t=this.attrs,l=this.state;"new"===l.loaded&&c({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(o){l.voters=o[t.poll.get("name")],l.loaded="loaded",e.scheduleRerender()})},html:function(e,t){var o=this,n=e.poll,s=n.get("options");if(s){var i=n.get("voters"),r=n.get("public"),u=_.clone(s).sort(function(e,t){return e.votes<t.votes?1:e.votes===t.votes?e.html<t.html?-1:1:-1}),c=0===i?Array(u.length).fill(0):u.map(function(e){return 100*e.votes/i}),d=e.isMultiple?c.map(Math.floor):(0,a.default)(c);return r&&this.fetchVoters(),u.map(function(s,i){var a=[],u=d[i].toString(),c=(e.vote||[]).includes(s.id);return a.push((0,l.h)("div.option",(0,l.h)("p",[(0,l.h)("span.percentage",u+"%"),p(s)]))),a.push((0,l.h)("div.bar-back",(0,l.h)("div.bar",{attributes:{style:"width:"+u+"%"}}))),r&&a.push(o.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+s.id},postId:e.post.id,optionId:s.id,pollName:n.get("name"),totalVotes:s.votes,pollVoters:t.voters&&t.voters[s.id]||[]})),(0,l.h)("li",{className:c?"chosen":""},a)})}}}),(0,t.createWidget)("discourse-poll-number-results",{buildKey:function(e){return e.id+"-number-results"},defaultState:function(){return{loaded:"new"}},fetchVoters:function(){var e=this,t=this.attrs,l=this.state;"new"===l.loaded&&c({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(o){l.voters=o[t.poll.get("name")],l.loaded="loaded",e.scheduleRerender()})},html:function(e,t){var o=e.poll,s=o.get("public"),i=o.get("options").reduce(function(e,t){return e+parseInt(t.html,10)*parseInt(t.votes,10)},0),a=o.voters,r=0===a?0:(0,u.default)(i/a,-2),p=I18n.t("poll.average_rating",{average:r}),c=[(0,l.h)("div.poll-results-number-rating",new n.default({html:"<span>"+p+"</span>"}))];return s&&(this.fetchVoters(),c.push(this.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+o.get("name")},totalVotes:o.get("voters"),pollVoters:t.voters||[],postId:e.post.id,pollName:o.get("name"),pollType:o.get("type")}))),c}}),(0,t.createWidget)("discourse-poll-container",{tagName:"div.poll-container",html:function(e){var t=this,o=e.poll;if(e.showResults){var n="number"===o.get("type")?"number":"standard";return this.attach("discourse-poll-"+n+"-results",e)}var s=o.get("options");if(s)return(0,l.h)("ul",s.map(function(l){return t.attach("discourse-poll-option",{option:l,isMultiple:e.isMultiple,vote:e.vote})}))}}),(0,t.createWidget)("discourse-poll-info",{tagName:"div.poll-info",multipleHelpText:function(e,t,l){if(t>0)if(e===t){if(e>1)return I18n.t("poll.multiple.help.x_options",{count:e})}else{if(e>1)return t<l?I18n.t("poll.multiple.help.between_min_and_max_options",{min:e,max:t}):I18n.t("poll.multiple.help.at_least_min_options",{count:e});if(t<=l)return I18n.t("poll.multiple.help.up_to_max_options",{count:t})}},html:function(e){var t=e.poll,o=t.get("voters"),s=[(0,l.h)("p",[(0,l.h)("span.info-number",o.toString()),(0,l.h)("span.info-text",I18n.t("poll.voters",{count:o}))])];if(e.isMultiple)if(e.showResults){var i=t.get("options").reduce(function(e,t){return e+parseInt(t.votes,10)},0);s.push((0,l.h)("p",[(0,l.h)("span.info-number",i.toString()),(0,l.h)("span.info-text",I18n.t("poll.total_votes",{count:i}))]))}else{var a=this.multipleHelpText(e.min,e.max,t.get("options.length"));a&&s.push(new n.default({html:"<span>"+a+"</span>"}))}return!e.showResults&&e.poll.get("public")&&s.push((0,l.h)("p",I18n.t("poll.public.title"))),s}}),(0,t.createWidget)("discourse-poll-buttons",{tagName:"div.poll-buttons",html:function(e){var t=[],l=e.poll,o=e.post,n=o.get("topic.archived"),s="closed"===l.get("status"),i=s||n;if(e.isMultiple&&!i){var a=!e.canCastVotes;t.push(this.attach("button",{className:"btn cast-votes "+(a?"":"btn-primary"),label:"poll.cast-votes.label",title:"poll.cast-votes.title",disabled:a,action:"castVotes"})),t.push(" ")}return e.showResults?t.push(this.attach("button",{className:"btn toggle-results",label:"poll.hide-results.label",title:"poll.hide-results.title",icon:"eye-slash",disabled:i,action:"toggleResults"})):t.push(this.attach("button",{className:"btn toggle-results",label:"poll.show-results.label",title:"poll.show-results.title",icon:"eye",disabled:0===l.get("voters"),action:"toggleResults"})),!this.currentUser||this.currentUser.get("id")!==o.get("user_id")&&!this.currentUser.get("staff")||n||(s?t.push(this.attach("button",{className:"btn toggle-status",label:"poll.open.label",title:"poll.open.title",icon:"unlock-alt",action:"toggleStatus"})):t.push(this.attach("button",{className:"btn toggle-status btn-danger",label:"poll.close.label",title:"poll.close.title",icon:"lock",action:"toggleStatus"}))),t}}),e.default=(0,t.createWidget)("discourse-poll",{tagName:"div.poll",buildKey:function(e){return e.id},buildAttributes:function(e){var t=e.poll;return{"data-poll-type":t.get("type"),"data-poll-name":t.get("name"),"data-poll-status":t.get("status"),"data-poll-public":t.get("public")}},defaultState:function(e){var t=e.poll,l=e.post;return{loading:!1,showResults:t.get("isClosed")||l.get("topic.archived")}},html:function(e,t){var o=t.showResults,n=jQuery.extend({},e,{showResults:o,canCastVotes:this.canCastVotes(),min:this.min(),max:this.max()});return(0,l.h)("div",[this.attach("discourse-poll-container",n),this.attach("discourse-poll-info",n),this.attach("discourse-poll-buttons",n)])},isClosed:function(){return"closed"===this.attrs.poll.get("status")},min:function(){var e=parseInt(this.attrs.poll.min,10);return(isNaN(e)||e<1)&&(e=1),e},max:function(){var e=parseInt(this.attrs.poll.max,10),t=this.attrs.poll.options.length;return(isNaN(e)||e>t)&&(e=t),e},canCastVotes:function(){var e=this.state,t=this.attrs;if(this.isClosed()||e.showResults||e.loading)return!1;var l=t.vote.length;return t.isMultiple?l>=this.min()&&l<=this.max():l>0},toggleStatus:function(){var e=this,t=this.state,l=this.attrs,o=l.poll,n="closed"===o.get("status");bootbox.confirm(I18n.t(n?"poll.open.confirm":"poll.close.confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(a){if(a){t.loading=!0;var r=n?"open":"closed";(0,s.ajax)("/polls/toggle_status",{type:"PUT",data:{post_id:l.post.get("id"),poll_name:o.get("name"),status:r}}).then(function(){o.set("status",r),e.scheduleRerender()}).catch(function(e){e?(0,i.popupAjaxError)(e):bootbox.alert(I18n.t("poll.error_while_toggling_status"))}).finally(function(){t.loading=!1})}})},toggleResults:function(){this.state.showResults=!this.state.showResults},showLogin:function(){this.register.lookup("route:application").send("showLogin")},toggleOption:function(e){if(!this.isClosed()){this.currentUser||this.showLogin();var t=this.attrs,l=t.vote,o=l.indexOf(e.id);return t.isMultiple||(l.length=0),-1!==o?l.splice(o,1):l.push(e.id),t.isMultiple?void 0:this.castVotes()}},castVotes:function(){if(this.canCastVotes()){if(!this.currentUser)return this.showLogin();var e=this.attrs,t=this.state;return t.loading=!0,(0,s.ajax)("/polls/vote",{type:"PUT",data:{post_id:e.post.id,poll_name:e.poll.name,options:e.vote}}).then(function(){t.showResults=!0}).catch(function(e){e?(0,i.popupAjaxError)(e):bootbox.alert(I18n.t("poll.error_while_casting_votes"))}).finally(function(){t.loading=!1})}}})}),define("discourse/plugins/poll/lib/discourse-markdown/poll",["exports"],function(e){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,l=Array(e.length);t<e.length;t++)l[t]=e[t];return l}return Array.from(e)}function l(e,t,l){(isNaN(t)||t<1)&&(t=1),(isNaN(l)||l>e)&&(l=e);var o=void 0;return l>0&&(t===l?t>1&&(o=I18n.t("poll.multiple.help.x_options",{count:t})):t>1?o=l<e?I18n.t("poll.multiple.help.between_min_and_max_options",{min:t,max:l}):I18n.t("poll.multiple.help.at_least_min_options",{count:t}):l<=e&&(o=I18n.t("poll.multiple.help.up_to_max_options",{count:l}))),o}function o(e,l,o){var n=e.indexOf(l),s=e[n].level;for(e.splice.apply(e,[n,1].concat(t(o))),o[0].map=l.map;n<e.length;n++){var i=e[n].nesting;i<0&&s--,e[n].level=s,i>0&&s++}}function n(e,t){for(var l=e.length-1,o=[],n=[];e[l]!==t;l--){if(0===l)return;var s=e[l];if(0===s.level&&"ol"!==s.tag&&"ul"!==s.tag)return;if(1===s.level&&1===s.nesting){if("li"!==s.tag)return;o.push([s,n.reverse().join(" ")])}1===s.level&&1===s.nesting&&"li"===s.tag?n=[]:"text"!==s.type&&"inline"!==s.type||n.push(s.content)}return o.reverse()}function s(e,t){e.push("text","",0).content="[/"+t+"]"}function i(e){e.registerOptions(function(e,t){var l=e.getCurrentUser&&e.getCurrentUser(e.userId)||e.currentUser,o=l&&l.staff;e.features.poll=!!t.poll_enabled||o,e.pollMaximumOptions=t.poll_maximum_options}),e.registerPlugin(function(e){e.block.bbcode.ruler.push("poll",w)})}function a(e){e.whiteList(["div.poll","div.poll-info","div.poll-container","div.poll-buttons","div[data-*]","span.info-number","span.info-text","a.button.cast-votes","a.button.toggle-results","li[data-*]"]),i(e)}function r(e,t){var l=e[0],o=e[1],n=e[2],s=e[3];l=p(l,o,n,s,t[0],7,-680876936),s=p(s,l,o,n,t[1],12,-389564586),n=p(n,s,l,o,t[2],17,606105819),o=p(o,n,s,l,t[3],22,-1044525330),l=p(l,o,n,s,t[4],7,-176418897),s=p(s,l,o,n,t[5],12,1200080426),n=p(n,s,l,o,t[6],17,-1473231341),o=p(o,n,s,l,t[7],22,-45705983),l=p(l,o,n,s,t[8],7,1770035416),s=p(s,l,o,n,t[9],12,-1958414417),n=p(n,s,l,o,t[10],17,-42063),o=p(o,n,s,l,t[11],22,-1990404162),l=p(l,o,n,s,t[12],7,1804603682),s=p(s,l,o,n,t[13],12,-40341101),n=p(n,s,l,o,t[14],17,-1502002290),o=p(o,n,s,l,t[15],22,1236535329),l=c(l,o,n,s,t[1],5,-165796510),s=c(s,l,o,n,t[6],9,-1069501632),n=c(n,s,l,o,t[11],14,643717713),o=c(o,n,s,l,t[0],20,-373897302),l=c(l,o,n,s,t[5],5,-701558691),s=c(s,l,o,n,t[10],9,38016083),n=c(n,s,l,o,t[15],14,-660478335),o=c(o,n,s,l,t[4],20,-405537848),l=c(l,o,n,s,t[9],5,568446438),s=c(s,l,o,n,t[14],9,-1019803690),n=c(n,s,l,o,t[3],14,-187363961),o=c(o,n,s,l,t[8],20,1163531501),l=c(l,o,n,s,t[13],5,-1444681467),s=c(s,l,o,n,t[2],9,-51403784),n=c(n,s,l,o,t[7],14,1735328473),o=c(o,n,s,l,t[12],20,-1926607734),l=d(l,o,n,s,t[5],4,-378558),s=d(s,l,o,n,t[8],11,-2022574463),n=d(n,s,l,o,t[11],16,1839030562),o=d(o,n,s,l,t[14],23,-35309556),l=d(l,o,n,s,t[1],4,-1530992060),s=d(s,l,o,n,t[4],11,1272893353),n=d(n,s,l,o,t[7],16,-155497632),o=d(o,n,s,l,t[10],23,-1094730640),l=d(l,o,n,s,t[13],4,681279174),s=d(s,l,o,n,t[0],11,-358537222),n=d(n,s,l,o,t[3],16,-722521979),o=d(o,n,s,l,t[6],23,76029189),l=d(l,o,n,s,t[9],4,-640364487),s=d(s,l,o,n,t[12],11,-421815835),n=d(n,s,l,o,t[15],16,530742520),o=d(o,n,s,l,t[2],23,-995338651),l=f(l,o,n,s,t[0],6,-198630844),s=f(s,l,o,n,t[7],10,1126891415),n=f(n,s,l,o,t[14],15,-1416354905),o=f(o,n,s,l,t[5],21,-57434055),l=f(l,o,n,s,t[12],6,1700485571),s=f(s,l,o,n,t[3],10,-1894986606),n=f(n,s,l,o,t[10],15,-1051523),o=f(o,n,s,l,t[1],21,-2054922799),l=f(l,o,n,s,t[8],6,1873313359),s=f(s,l,o,n,t[15],10,-30611744),n=f(n,s,l,o,t[6],15,-1560198380),o=f(o,n,s,l,t[13],21,1309151649),l=f(l,o,n,s,t[4],6,-145523070),s=f(s,l,o,n,t[11],10,-1120210379),n=f(n,s,l,o,t[2],15,718787259),o=f(o,n,s,l,t[9],21,-343485551),e[0]=g(l,e[0]),e[1]=g(o,e[1]),e[2]=g(n,e[2]),e[3]=g(s,e[3])}function u(e,t,l,o,n,s){return t=g(g(t,e),g(o,s)),g(t<<n|t>>>32-n,l)}function p(e,t,l,o,n,s,i){return u(t&l|~t&o,e,t,n,s,i)}function c(e,t,l,o,n,s,i){return u(t&o|l&~o,e,t,n,s,i)}function d(e,t,l,o,n,s,i){return u(t^l^o,e,t,n,s,i)}function f(e,t,l,o,n,s,i){return u(l^(t|~o),e,t,n,s,i)}function h(e){/[\x80-\xFF]/.test(e)&&(e=unescape(encodeURI(e)));var t,l=e.length,o=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)r(o,m(e.substring(t-64,t)));e=e.substring(t-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)n[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(n[t>>2]|=128<<(t%4<<3),t>55)for(r(o,n),t=0;t<16;t++)n[t]=0;return n[14]=8*l,r(o,n),o}function m(e){var t,l=[];for(t=0;t<64;t+=4)l[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return l}function b(e){for(var t="",l=0;l<4;l++)t+=x[e>>8*l+4&15]+x[e>>8*l&15];return t}function v(e){for(var t=0;t<e.length;t++)e[t]=b(e[t]);return e.join("")}function g(e,t){return e+t&4294967295}function _(e){return v(h(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.setup=a;var y=["type","name","min","max","step","order","status","public"],w={tag:"poll",before:function(e,t,l){var o=e.push("text","",0);o.content=l,o.bbcode_attrs=t.attrs,o.bbcode_type="poll_open"},after:function(e,t,i){var a=n(e.tokens,t);if(!a)return s(e,i);var r=t.bbcode_attrs,u=[["class","poll"]];r.status||u.push(["data-poll-status","open"]),y.forEach(function(e){r[e]&&u.push(["data-poll-"+e,r[e]])}),r.name||u.push(["data-poll-name","poll"]);var p=parseInt(r.min,10),c=parseInt(r.max,10),d=parseInt(r.step,10);d<1&&(d=1);var f=[],h=new e.Token("poll_open","div",1);if(h.block=!0,h.attrs=u,f.push(h),h=new e.Token("poll_open","div",1),h.block=!0,f.push(h),h=new e.Token("poll_open","div",1),h.attrs=[["class","poll-container"]],f.push(h),"number"===r.type){if(isNaN(p)&&(p=1),isNaN(c)&&(c=e.md.options.discourse.pollMaximumOptions),isNaN(d)&&(d=1),a.length>0)return s(e,i);h=new e.Token("bullet_list_open","ul",1),f.push(h);for(var m=p;m<=c;m+=d)h=new e.Token("list_item_open","li",1),a.push([h,String(m)]),f.push(h),h=new e.Token("text","",0),h.content=String(m),f.push(h),h=new e.Token("list_item_close","li",-1),f.push(h);h=new e.Token("bullet_item_close","",-1),f.push(h)}for(var b=0;b<a.length;b++){h=a[b][0];var v=a[b][1];h.attrs=h.attrs||[];var g=_(JSON.stringify([v]));h.attrs.push(["data-poll-option-id",g])}if(o(e.tokens,t,f),e.level=e.tokens[e.tokens.length-1].level,e.push("poll_close","div",-1),h=e.push("poll_open","div",1),h.attrs=[["class","poll-info"]],e.push("paragraph_open","p",1),h=e.push("span_open","span",1),h.block=!1,h.attrs=[["class","info-number"]],h=e.push("text","",0),h.content="0",e.push("span_close","span",-1),h=e.push("span_open","span",1),h.block=!1,h.attrs=[["class","info-text"]],h=e.push("text","",0),h.content=I18n.t("poll.voters",{count:0}),e.push("span_close","span",-1),e.push("paragraph_close","p",-1),"multiple"===u["data-poll-type"]){var w=l(a.length,p,c);w&&(e.push("paragraph_open","p",1),h=e.push("html_inline","",0),h.content=w,e.push("paragraph_close","p",-1))}"true"===u["data-poll-public"]&&(e.push("paragraph_open","p",1),h=e.push("text","",0),h.content=I18n.t("poll.public.title"),e.push("paragraph_close","p",-1)),e.push("poll_close","div",-1),e.push("poll_close","div",-1),h=e.push("poll_open","div",1),h.attrs=[["class","poll-buttons"]],"multiple"===u["data-poll-type"]&&(h=e.push("link_open","a",1),h.block=!1,h.attrs=[["class","button cast-votes"],["title",I18n.t("poll.cast-votes.title")]],h=e.push("text","",0),h.content=I18n.t("poll.cast-votes.label"),e.push("link_close","a",-1)),h=e.push("link_open","a",1),h.block=!1,h.attrs=[["class","button toggle-results"],["title",I18n.t("poll.show-results.title")]],h=e.push("text","",0),h.content=I18n.t("poll.show-results.label"),e.push("link_close","a",-1),e.push("poll_close","div",-1),e.push("poll_close","div",-1)}
},x="0123456789abcdef".split("")}),define("discourse/plugins/poll/lib/even-round",["exports"],function(e){"use strict";function t(e){return 100===e.map(function(e){return Math.floor(e)}).reduce(function(e,t){return e+t})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){for(var l=e.map(function(e){return e%1}),o=Math.ceil(l.reduce(function(e,t){return e+t})),n=0,s=l.length;n<o&&n<s;n++){for(var i=0,a=0,r=0;r<l.length;r++)l[r]>i&&(a=r,i=l[r]);if(++e[a],l[a]=0,t(e))break}return e.map(function(e){return Math.floor(e)})}}),Ember.TEMPLATES["javascripts/modal/poll-ui-builder"]=Ember.HTMLBars.template({id:null,block:'{"statements":[[6,["d-modal-body"],null,[["title","class"],["poll.ui_builder.title","poll-ui-builder"]],{"statements":[[0,"  "],[11,"form",[]],[15,"class","poll-ui-builder-form form-horizontal"],[13],[0,"\\n    "],[11,"div",[]],[15,"class","input-group"],[13],[0,"\\n      "],[11,"label",[]],[15,"class","input-group-label"],[13],[1,[33,["i18n"],["poll.ui_builder.poll_type.label"],null],false],[14],[0,"\\n      "],[1,[33,["combo-box"],null,[["content","value","valueAttribute"],[[28,["pollTypes"]],[28,["pollType"]],"value"]]],false],[0,"\\n    "],[14],[0,"\\n\\n"],[6,["if"],[[28,["showMinMax"]]],null,{"statements":[[0,"      "],[11,"div",[]],[15,"class","input-group"],[13],[0,"\\n        "],[11,"label",[]],[15,"class","input-group-label"],[13],[1,[33,["i18n"],["poll.ui_builder.poll_config.min"],null],false],[14],[0,"\\n        "],[1,[33,["input"],null,[["type","value","valueAttribute","class"],["number",[28,["pollMin"]],"value","poll-options-min"]]],false],[0,"\\n        "],[1,[33,["input-tip"],null,[["validation"],[[28,["minMaxValueValidation"]]]]],false],[0,"\\n      "],[14],[0,"\\n\\n\\n      "],[11,"div",[]],[15,"class","input-group"],[13],[0,"\\n        "],[11,"label",[]],[15,"class","input-group-label"],[13],[1,[33,["i18n"],["poll.ui_builder.poll_config.max"],null],false],[14],[0,"\\n        "],[1,[33,["input"],null,[["type","value","valueAttribute","class"],["number",[28,["pollMax"]],"value","poll-options-max"]]],false],[0,"\\n      "],[14],[0,"\\n\\n"],[6,["if"],[[28,["isNumber"]]],null,{"statements":[[0,"        "],[11,"div",[]],[15,"class","input-group"],[13],[0,"\\n          "],[11,"label",[]],[15,"class","input-group-label"],[13],[1,[33,["i18n"],["poll.ui_builder.poll_config.step"],null],false],[14],[0,"\\n          "],[1,[33,["input"],null,[["type","value","valueAttribute","min","class"],["number",[28,["pollStep"]],"value","1","poll-options-step"]]],false],[0,"\\n          "],[1,[33,["input-tip"],null,[["validation"],[[28,["minStepValueValidation"]]]]],false],[0,"\\n        "],[14],[0,"\\n"]],"locals":[]},null]],"locals":[]},null],[0,"\\n    "],[11,"div",[]],[15,"class","input-group"],[13],[0,"\\n      "],[11,"label",[]],[13],[0,"\\n        "],[1,[33,["input"],null,[["type","checked"],["checkbox",[28,["publicPoll"]]]]],false],[0,"\\n        "],[1,[33,["i18n"],["poll.ui_builder.poll_public.label"],null],false],[0,"\\n      "],[14],[0,"\\n    "],[14],[0,"\\n\\n"],[6,["unless"],[[28,["isNumber"]]],null,{"statements":[[0,"      "],[11,"div",[]],[15,"class","input-group"],[13],[0,"\\n        "],[11,"label",[]],[13],[1,[33,["i18n"],["poll.ui_builder.poll_options.label"],null],false],[14],[0,"\\n        "],[1,[33,["input-tip"],null,[["validation"],[[28,["minNumOfOptionsValidation"]]]]],false],[0,"\\n        "],[1,[33,["textarea"],null,[["value"],[[28,["pollOptions"]]]]],false],[0,"\\n      "],[14],[0,"\\n"]],"locals":[]},null],[0,"  "],[14],[0,"\\n"]],"locals":[]},null],[0,"\\n"],[11,"div",[]],[15,"class","modal-footer"],[13],[0,"\\n  "],[1,[33,["d-button"],null,[["action","icon","class","label","disabled"],["insertPoll","bar-chart-o","btn-primary","poll.ui_builder.insert",[28,["disableInsert"]]]]],false],[0,"\\n"],[14],[0,"\\n"]],"locals":[],"named":[],"yields":[],"hasPartials":false}',meta:{moduleName:"javascripts/modal/poll-ui-builder"}}),define("discourse/plugins/poll/controllers/poll-ui-builder",["exports","ember-addons/ember-computed-decorators","discourse/models/input-validation"],function(e,t,l){"use strict";function o(e,t,l,o,n){var s={};return Object.keys(o).forEach(function(e){s[e]=o[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=l.slice().reverse().reduce(function(l,o){return o(e,t,l)||l},s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}Object.defineProperty(e,"__esModule",{value:!0});var n,s,i,a,r,u,p,c,d,f,h,m,b,v,g,y;e.default=Ember.Controller.extend((n=(0,t.default)("regularPollType","numberPollType","multiplePollType"),s=(0,t.default)("pollType","regularPollType"),i=(0,t.default)("pollType","pollOptionsCount","multiplePollType"),a=(0,t.default)("pollType","numberPollType"),r=(0,t.default)("isRegular"),u=(0,t.default)("pollOptions"),p=(0,t.observes)("isMultiple","isNumber","pollOptionsCount"),c=(0,t.default)("isRegular","isMultiple","isNumber","pollOptionsCount"),d=(0,t.default)("isRegular","isMultiple","isNumber","pollOptionsCount","pollMin","pollStep"),f=(0,t.default)("isNumber","pollMax"),h=(0,t.default)("isNumber","showMinMax","pollType","publicPoll","pollOptions","pollMin","pollMax","pollStep"),m=(0,t.default)("pollOptionsCount","isRegular","isMultiple","isNumber","pollMin","pollMax"),b=(0,t.default)("pollMin","pollMax"),v=(0,t.default)("pollStep"),g=(0,t.default)("disableInsert"),y={regularPollType:"regular",numberPollType:"number",multiplePollType:"multiple",init:function(){this._super(),this._setupPoll()},pollTypes:function(e,t,l){var o=[];return o.push({name:I18n.t("poll.ui_builder.poll_type.regular"),value:e}),o.push({name:I18n.t("poll.ui_builder.poll_type.number"),value:t}),o.push({name:I18n.t("poll.ui_builder.poll_type.multiple"),value:l}),o},isRegular:function(e,t){return e===t},isMultiple:function(e,t,l){return e===l&&t>0},isNumber:function(e,t){return e===t},showMinMax:function(e){return!e},pollOptionsCount:function(e){if(0===e.length)return 0;var t=0;return e.split("\n").forEach(function(e){0!==e.length&&(t+=1)}),t},_setPollMax:function(){var e=this.get("isMultiple"),t=this.get("isNumber");(e||t)&&(e?this.set("pollMax",this.get("pollOptionsCount")):t&&this.set("pollMax",this.siteSettings.poll_maximum_options))},pollMinOptions:function(e,t,l,o){if(!e)return t?this._comboboxOptions(1,o+1):l?this._comboboxOptions(1,this.siteSettings.poll_maximum_options+1):void 0},pollMaxOptions:function(e,t,l,o,n,s){if(!e){var i=parseInt(n)||1;if(t)return this._comboboxOptions(i+1,o+1);if(l){var a=parseInt(s,10);return a<1&&(a=1),this._comboboxOptions(i+1,i+this.siteSettings.poll_maximum_options*a)}}},pollStepOptions:function(e,t){if(e)return this._comboboxOptions(1,(parseInt(t)||1)+1)},pollOutput:function(e,t,l,o,n,s,i,a){var r="[poll",u="",p=this.get("toolbarEvent").getText().match(/\[poll(\s+name=[^\s\]]+)*.*\]/gim);p&&(r+=" name=poll"+(p.length+1));var c=a;return c<1&&(c=1),l&&(r+=" type="+l),s&&t&&(r+=" min="+s),i&&(r+=" max="+i),e&&(r+=" step="+c),o&&(r+=" public=true"),r+="]",u+=r+"\n",n.length>0&&!e&&n.split("\n").forEach(function(e){0!==e.length&&(u+="* "+e+"\n")}),u+="[/poll]"},disableInsert:function(e,t,l,o,n,s){return t&&e<2||l&&e<n&&n>=s||!o&&e<2},minMaxValueValidation:function(e,t){var o={ok:!0};return e>=t&&(o={failed:!0,reason:I18n.t("poll.ui_builder.help.invalid_values")}),l.default.create(o)},minStepValueValidation:function(e){var t={ok:!0};return e<1&&(t={failed:!0,reason:I18n.t("poll.ui_builder.help.min_step_value")}),l.default.create(t)},minNumOfOptionsValidation:function(e){var t={ok:!0};return e&&(t={failed:!0,reason:I18n.t("poll.ui_builder.help.options_count")}),l.default.create(t)},_comboboxOptions:function(e,t){return _.range(e,t).map(function(e){return{value:e,name:e}})},_setupPoll:function(){this.setProperties({pollType:null,publicPoll:!1,pollOptions:"",pollMin:1,pollMax:null,pollStep:1})},actions:{insertPoll:function(){this.get("toolbarEvent").addText(this.get("pollOutput")),this.send("closeModal"),this._setupPoll()}}},o(y,"pollTypes",[n],Object.getOwnPropertyDescriptor(y,"pollTypes"),y),o(y,"isRegular",[s],Object.getOwnPropertyDescriptor(y,"isRegular"),y),o(y,"isMultiple",[i],Object.getOwnPropertyDescriptor(y,"isMultiple"),y),o(y,"isNumber",[a],Object.getOwnPropertyDescriptor(y,"isNumber"),y),o(y,"showMinMax",[r],Object.getOwnPropertyDescriptor(y,"showMinMax"),y),o(y,"pollOptionsCount",[u],Object.getOwnPropertyDescriptor(y,"pollOptionsCount"),y),o(y,"_setPollMax",[p],Object.getOwnPropertyDescriptor(y,"_setPollMax"),y),o(y,"pollMinOptions",[c],Object.getOwnPropertyDescriptor(y,"pollMinOptions"),y),o(y,"pollMaxOptions",[d],Object.getOwnPropertyDescriptor(y,"pollMaxOptions"),y),o(y,"pollStepOptions",[f],Object.getOwnPropertyDescriptor(y,"pollStepOptions"),y),o(y,"pollOutput",[h],Object.getOwnPropertyDescriptor(y,"pollOutput"),y),o(y,"disableInsert",[m],Object.getOwnPropertyDescriptor(y,"disableInsert"),y),o(y,"minMaxValueValidation",[b],Object.getOwnPropertyDescriptor(y,"minMaxValueValidation"),y),o(y,"minStepValueValidation",[v],Object.getOwnPropertyDescriptor(y,"minStepValueValidation"),y),o(y,"minNumOfOptionsValidation",[g],Object.getOwnPropertyDescriptor(y,"minNumOfOptionsValidation"),y),y))}),define("discourse/plugins/poll/initializers/extend-for-poll",["exports","discourse/lib/plugin-api","ember-addons/ember-computed-decorators","discourse-common/lib/get-owner","discourse/widgets/glue"],function(e,t,l,o,n){"use strict";function s(e,t,l,o,n){var s={};return Object.keys(o).forEach(function(e){s[e]=o[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=l.slice().reverse().reduce(function(l,o){return o(e,t,l)||l},s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}function i(e){function t(t,l){var o=$(".poll",t);if(o.length){var s=l.getModel();e.preventCloak(s.id);var i=s.get("polls_votes")||{};s.pollsChanged();var a=s.get("pollsObject");a&&o.each(function(e,t){var l=$(t),o=l.data("poll-name"),r=a[o];if(r){var c="multiple"===r.get("type"),d=new n.default("discourse-poll",u,{id:o+"-"+s.id,post:s,poll:r,vote:i[o]||[],isMultiple:c});d.appendTo(t),p.push(d)}})}}function i(){p.forEach(function(e){return e.cleanUp()})}var a,r,u=(0,o.getRegister)(e);e.modifyClass("controller:topic",{subscribe:function(){var e=this;this._super(),this.messageBus.subscribe("/polls/"+this.get("model.id"),function(t){var l=e.get("model.postStream").findLoadedPost(t.post_id);l&&l.set("polls",t.polls)})},unsubscribe:function(){this.messageBus.unsubscribe("/polls/*"),this._super()}}),e.modifyClass("model:post",(a=(0,l.observes)("polls"),r={_polls:null,pollsObject:null,pollsChanged:function(){var e=this,t=this.get("polls");t&&(this._polls=this._polls||{},_.map(t,function(t,l){e._polls[l]?e._polls[l].setProperties(t):e._polls[l]=Em.Object.create(t)}),this.set("pollsObject",this._polls),p.forEach(function(e){return e.queueRerender()}))}},s(r,"pollsChanged",[a],Object.getOwnPropertyDescriptor(r,"pollsChanged"),r),r));var p=[];e.includePostAttributes("polls","polls_votes"),e.decorateCooked(t,{onlyStream:!0}),e.cleanupStream(i)}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"extend-for-poll",initialize:function(){(0,t.withPluginApi)("0.8.7",i)}}}),define("discourse/plugins/poll/initializers/add-poll-ui-builder",["exports","discourse/lib/plugin-api","discourse/lib/show-modal"],function(e,t,l){"use strict";function o(e){(e.container.lookup("site-settings:main").poll_enabled||!e.getCurrentUser()||e.getCurrentUser().staff)&&(e.modifyClass("controller:composer",{actions:{showPollBuilder:function(){(0,l.default)("poll-ui-builder").set("toolbarEvent",this.get("toolbarEvent"))}}}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"showPollBuilder",icon:"bar-chart-o",label:"poll.ui_builder.title"}}))}Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"add-poll-ui-builder",initialize:function(){(0,t.withPluginApi)("0.8.7",o)}}});
//# sourceMappingURL=/assets/plugin-ce9106f1bb35f6d3753d242570b97565c62930c0ef86673e2121cb55e847d545.js.map